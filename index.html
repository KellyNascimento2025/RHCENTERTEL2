<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal RH Centertel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f6fa;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #00a8a8, #ff9500);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .logo {
            font-size: 1.8em;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .nav-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 30px;
            background: white;
            padding: 10px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .nav-tab {
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-size: 14px;
            color: #666;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #00a8a8, #ff9500);
            color: white;
            transform: translateY(-2px);
        }

        .nav-tab:hover:not(.active) {
            background: #f8f9fa;
        }

        .content-area {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 600px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .stat-card:nth-child(2) {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stat-card:nth-child(3) {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .stat-card:nth-child(4) {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
            font-size: 14px;
        }

        .btn-primary {
            background: #00a8a8;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #333;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }

        .employee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .employee-card {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .employee-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .employee-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .employee-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00a8a8, #ff9500);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }

        .employee-info {
            flex: 1;
        }

        .employee-name {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        .employee-position {
            color: #666;
            font-size: 0.9em;
        }

        .employee-details {
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 0.9em;
        }

        .detail-label {
            color: #666;
        }

        .detail-value {
            font-weight: 500;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid #e9ecef;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: linear-gradient(135deg, #00a8a8, #ff9500);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e9ecef;
        }

        .close-btn {
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
            border: none;
            background: none;
        }

        .close-btn:hover {
            color: #dc3545;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #00a8a8;
        }

        .search-bar {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .search-input {
            flex: 1;
            padding: 12px 20px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 2000;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: #dc3545;
        }

        .alert {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }

        .file-upload {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #00a8a8;
            background: #f8f9fa;
        }

        .hidden {
            display: none;
        }

        .confirmation-dialog {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .confirmation-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-experience {
            background: #fff3cd;
            color: #856404;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stats-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stats-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #00a8a8;
        }

        .stats-label {
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
            
            .nav-tabs {
                justify-content: center;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .employee-grid {
                grid-template-columns: 1fr;
            }
            
            .search-bar {
                flex-direction: column;
            }
            
            .search-input {
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">🏢 CENTERTEL RH</div>
            <div class="user-info">
                <span id="userName">Administrador</span>
                <button class="btn btn-secondary" onclick="logout()">Sair</button>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard', this)">📊 Dashboard</button>
            <button class="nav-tab" onclick="showTab('employees', this)">👥 Funcionários</button>
            <button class="nav-tab" onclick="showTab('terminated', this)">🚪 Desligados</button>
            <button class="nav-tab" onclick="showTab('vacation', this)">🏖️ Férias</button>
            <button class="nav-tab" onclick="showTab('experience', this)">⏰ Experiência</button>
            <button class="nav-tab" onclick="showTab('benefits', this)">🎁 Benefícios</button>
            <button class="nav-tab" onclick="showTab('vales', this)">💳 Vales</button>
            <button class="nav-tab" onclick="showTab('reports', this)">📈 Relatórios</button>
            <button class="nav-tab" onclick="showTab('settings', this)">⚙️ Configurações</button>
        </nav>

        <!-- Content Area -->
        <main class="content-area" id="contentArea">
            <!-- Content will be loaded here -->
        </main>
    </div>

    <!-- Modal -->
    <div class="modal" id="modal">
        <div class="modal-content" id="modalContent">
            <!-- Modal content will be inserted here -->
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <script>
        // Database
        let employees = [
            {
                id: 1,
                matricula: "CT0001",
                name: "ISABELA CRISTINA SOUZA",
                position: "SUPERVISOR DE VENDAS",
                team: "ISABELA",
                admission: "2023-01-15",
                salary: 3500,
                contract: "CLT",
                city: "GOIÂNIA",
                phone: "(62) 98123-4567",
                email: "isabela@centertel.com",
                status: "active",
                lastVacation: "2024-02-01",
                contractType: "permanent"
            },
            {
                id: 2,
                matricula: "CT0431",
                name: "ANNA BEATRIZ SOUZA ARAUJO",
                position: "ESTAGIO/VENDAS",
                team: "ISABELA",
                admission: "2025-05-12",
                salary: 1000,
                contract: "MAIS TALENTOS",
                city: "GOIÂNIA",
                phone: "(62) 99246-2748",
                email: "annabeatriz2007ann@gmail.com",
                status: "active",
                lastVacation: null,
                contractType: "experience"
            },
            {
                id: 3,
                matricula: "CT0298",
                name: "DANIEL GUILHERME SILVA REIS",
                position: "QUALIDADE ESTAGIO",
                team: "ISABELA",
                admission: "2025-04-01",
                salary: 900,
                contract: "MAIS TALENTOS",
                city: "GOIÂNIA",
                phone: "(62) 99322-2911",
                email: "danielguilherme7854@gmail.com",
                status: "active",
                lastVacation: null,
                contractType: "experience"
            },
            {
                id: 4,
                matricula: "CT0102",
                name: "MARCOS FELIPE SANTOS",
                position: "CONSULTOR DE VENDAS",
                team: "ISABELA",
                admission: "2023-06-10",
                salary: 1518,
                contract: "CLT",
                city: "GOIÂNIA",
                phone: "(62) 98234-5678",
                email: "marcos.felipe@centertel.com",
                status: "active",
                lastVacation: "2024-07-15",
                contractType: "permanent"
            },
            {
                id: 5,
                matricula: "CT0103",
                name: "JULIA OLIVEIRA COSTA",
                position: "CONSULTOR DE VENDAS",
                team: "ISABELA",
                admission: "2023-07-20",
                salary: 1518,
                contract: "CLT",
                city: "GOIÂNIA",
                phone: "(62) 98345-6789",
                email: "julia.costa@centertel.com",
                status: "active",
                lastVacation: "2023-12-01",
                contractType: "permanent"
            },
            // Funcionário desligado de exemplo
            {
                id: 6,
                matricula: "CT0050",
                name: "CARLOS EDUARDO FERREIRA",
                position: "CONSULTOR DE VENDAS",
                team: "ISABELA",
                admission: "2023-03-15",
                salary: 1518,
                contract: "CLT",
                city: "GOIÂNIA",
                phone: "(62) 98765-4321",
                email: "carlos.eduardo@centertel.com",
                status: "terminated",
                lastVacation: null,
                contractType: "permanent",
                terminationDate: "2025-05-15",
                terminationReason: "pedido_demissao",
                terminationNotes: "Funcionário solicitou demissão para buscar novas oportunidades."
            }
        ];

        let vales = [
            {
                id: 1,
                employeeId: 2,
                employeeName: "ANNA BEATRIZ SOUZA ARAUJO",
                value: 150.00,
                date: "2025-06-01",
                type: "alimentacao",
                description: "Vale alimentação",
                status: "ativo"
            },
            {
                id: 2,
                employeeId: 3,
                employeeName: "DANIEL GUILHERME SILVA REIS",
                value: 200.00,
                date: "2025-06-03",
                type: "transporte",
                description: "Vale transporte",
                status: "ativo"
            },
            {
                id: 3,
                employeeId: 4,
                employeeName: "MARCOS FELIPE SANTOS",
                value: 100.00,
                date: "2025-06-05",
                type: "combustivel",
                description: "Vale combustível",
                status: "ativo"
            }
        ];

        let benefits = [
            {
                id: 1,
                employeeId: 1,
                employeeName: "ISABELA CRISTINA SOUZA",
                type: "vale_alimentacao",
                value: 400.00,
                startDate: "2025-01-01",
                endDate: "2025-12-31",
                status: "active",
                description: "Vale alimentação mensal"
            },
            {
                id: 2,
                employeeId: 2,
                employeeName: "ANNA BEATRIZ SOUZA ARAUJO",
                type: "vale_alimentacao",
                value: 300.00,
                startDate: "2025-05-12",
                endDate: "2025-12-31",
                status: "active",
                description: "Vale alimentação mensal"
            },
            {
                id: 3,
                employeeId: 1,
                employeeName: "ISABELA CRISTINA SOUZA",
                type: "vale_transporte",
                value: 200.00,
                startDate: "2025-01-01",
                endDate: "2025-12-31",
                status: "active",
                description: "Vale transporte mensal"
            }
        ];

        let systemUsers = [
            {
                id: 1,
                name: "Administrador",
                email: "admin@centertel.com",
                password: "admin123",
                role: "admin",
                status: "active"
            }
        ];

        // State
        let currentTab = 'dashboard';
        let currentSearchTerm = '';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showTab('dashboard');
        });

        // Navigation
        function showTab(tabName, element) {
            currentTab = tabName;
            
            // Update active tab
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            if (element) {
                element.classList.add('active');
            } else {
                // Find and activate the correct tab if called programmatically
                const tabs = document.querySelectorAll('.nav-tab');
                tabs.forEach(tab => {
                    if (tab.textContent.toLowerCase().includes(tabName.toLowerCase())) {
                        tab.classList.add('active');
                    }
                });
            }

            // Render content
            switch(tabName) {
                case 'dashboard':
                    renderDashboard();
                    break;
                case 'employees':
                    renderEmployees();
                    break;
                case 'terminated':
                    renderTerminated();
                    break;
                case 'vacation':
                    renderVacation();
                    break;
                case 'experience':
                    renderExperience();
                    break;
                case 'benefits':
                    renderBenefits();
                    break;
                case 'vales':
                    renderVales();
                    break;
                case 'reports':
                    renderReports();
                    break;
                case 'settings':
                    renderSettings();
                    break;
                default:
                    renderDashboard();
            }
        }

        // Dashboard
        function renderDashboard() {
            const vacationDue = getVacationDue();
            const experienceExpiring = getExperienceExpiring();
            const totalSalary = employees.filter(e => e.status === 'active').reduce((sum, e) => sum + e.salary, 0);
            const totalBenefits = benefits.filter(b => b.status === 'active').reduce((sum, b) => sum + b.value, 0);
            
            document.getElementById('contentArea').innerHTML = `
                <h1 style="margin-bottom: 30px; color: #333;">📊 Dashboard Executivo</h1>
                
                ${(vacationDue.length > 0 || experienceExpiring.length > 0) ? `
                    <div class="alert">
                        <h3 style="margin: 0 0 15px 0;">⚠️ Alertas Importantes</h3>
                        ${vacationDue.length > 0 ? `
                            <p><strong>🏖️ Férias vencendo:</strong> ${vacationDue.length} funcionário${vacationDue.length > 1 ? 's' : ''}</p>
                        ` : ''}
                        ${experienceExpiring.length > 0 ? `
                            <p><strong>⏰ Contratos vencendo:</strong> ${experienceExpiring.length} funcionário${experienceExpiring.length > 1 ? 's' : ''}</p>
                        ` : ''}
                    </div>
                ` : ''}
                
                <div class="dashboard-grid">
                    <div class="stat-card" onclick="showTab('employees')">
                        <div class="stat-number">${employees.filter(e => e.status === 'active').length}</div>
                        <div class="stat-label">👥 Funcionários Ativos</div>
                    </div>
                    
                    <div class="stat-card" onclick="showTab('terminated')">
                        <div class="stat-number">${employees.filter(e => e.status === 'terminated').length}</div>
                        <div class="stat-label">🚪 Funcionários Desligados</div>
                    </div>
                    
                    <div class="stat-card" onclick="showTab('vacation')">
                        <div class="stat-number">${vacationDue.length}</div>
                        <div class="stat-label">🏖️ Férias a Vencer</div>
                    </div>
                    
                    <div class="stat-card" onclick="showTab('experience')">
                        <div class="stat-number">${experienceExpiring.length}</div>
                        <div class="stat-label">⏰ Experiência Vencendo</div>
                    </div>
                </div>
                
                <div class="stats-grid">
                    <div class="stats-item">
                        <div class="stats-value">R$ ${totalSalary.toLocaleString('pt-BR')}</div>
                        <div class="stats-label">💰 Folha Mensal</div>
                    </div>
                    
                    <div class="stats-item">
                        <div class="stats-value">R$ ${totalBenefits.toLocaleString('pt-BR')}</div>
                        <div class="stats-label">🎁 Total Benefícios</div>
                    </div>
                    
                    <div class="stats-item">
                        <div class="stats-value">${benefits.filter(b => b.status === 'active').length}</div>
                        <div class="stats-label">🎁 Benefícios Ativos</div>
                    </div>
                    
                    <div class="stats-item">
                        <div class="stats-value">${vales.length}</div>
                        <div class="stats-label">💳 Vales do Mês</div>
                    </div>
                    
                    <div class="stats-item">
                        <div class="stats-value">${employees.filter(e => e.contractType === 'experience' && e.status === 'active').length}</div>
                        <div class="stats-label">👤 Em Experiência</div>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px; color: #333;">📊 Distribuição por Equipe</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        ${getTeamStats().map(team => `
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; text-align: center;">
                                <div style="font-weight: bold; color: #00a8a8;">${team.name}</div>
                                <div style="font-size: 1.2em; font-weight: bold; margin: 5px 0;">${team.count}</div>
                                <div style="color: #666; font-size: 0.9em;">funcionários</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function getTerminationReasonText(reason) {
            const reasons = {
                'demissao_sem_justa_causa': 'Demissão sem justa causa',
                'demissao_com_justa_causa': 'Demissão com justa causa',
                'pedido_demissao': 'Pedido de demissão',
                'fim_contrato': 'Fim de contrato',
                'aposentadoria': 'Aposentadoria',
                'falecimento': 'Falecimento',
                'outros': 'Outros'
            };
            return reasons[reason] || reason;
        }

        // Terminated Employees
        function renderTerminated() {
            const terminatedEmployees = employees.filter(e => e.status === 'terminated');
            
            document.getElementById('contentArea').innerHTML = `
                <h1 style="margin-bottom: 30px; color: #333;">🚪 Funcionários Desligados</h1>
                
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="🔍 Buscar funcionários desligados..." oninput="filterTerminated(this.value)">
                    <button class="btn btn-warning" onclick="downloadReport('terminated')" ${terminatedEmployees.length === 0 ? 'disabled' : ''}>📥 Relatório</button>
                </div>
                
                <p style="margin-bottom: 20px; color: #666;">
                    <strong id="terminatedCount">${terminatedEmployees.length}</strong> funcionário${terminatedEmployees.length !== 1 ? 's' : ''} desligado${terminatedEmployees.length !== 1 ? 's' : ''}
                </p>
                
                ${terminatedEmployees.length > 0 ? `
                    <div class="employee-grid" id="terminatedGrid">
                        ${terminatedEmployees.map(emp => `
                            <div class="employee-card" data-search="${emp.name} ${emp.position} ${emp.matricula} ${emp.team}" style="border-left: 4px solid #dc3545; opacity: 0.8;">
                                <div class="employee-header">
                                    <div class="employee-avatar" style="background: linear-gradient(135deg, #dc3545, #6c757d);">
                                        ${getInitials(emp.name)}
                                    </div>
                                    <div class="employee-info">
                                        <div class="employee-name">${emp.name}</div>
                                        <div class="employee-position">${emp.position}</div>
                                        <span class="status-badge" style="background: #f8d7da; color: #721c24;">
                                            Desligado
                                        </span>
                                    </div>
                                </div>
                                
                                <div class="employee-details">
                                    <div class="detail-item">
                                        <span class="detail-label">Matrícula:</span>
                                        <span class="detail-value">${emp.matricula}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Equipe:</span>
                                        <span class="detail-value">${emp.team}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Salário:</span>
                                        <span class="detail-value">R$ ${emp.salary.toLocaleString('pt-BR')}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Admissão:</span>
                                        <span class="detail-value">${formatDate(emp.admission)}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Desligamento:</span>
                                        <span class="detail-value">${formatDate(emp.terminationDate)}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Motivo:</span>
                                        <span class="detail-value">${getTerminationReasonText(emp.terminationReason)}</span>
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 5px;">
                                    <button class="btn btn-secondary" onclick="viewEmployee(${emp.id})" style="flex: 1; font-size: 0.9em;">👁️ Ver</button>
                                    <button class="btn btn-success" onclick="reactivateEmployee(${emp.id})" style="flex: 1; font-size: 0.9em;">🔄 Reativar</button>
                                    <button class="btn btn-danger" onclick="confirmPermanentDelete(${emp.id})" style="flex: 1; font-size: 0.9em;">🗑️ Excluir</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : `
                    <div style="text-align: center; padding: 60px; color: #666;">
                        <div style="font-size: 4em; margin-bottom: 20px;">🎉</div>
                        <h3 style="color: #28a745;">Nenhum funcionário desligado!</h3>
                        <p>Não há funcionários desligados no momento.</p>
                    </div>
                `}
            `;
        }

        function filterTerminated(searchTerm) {
            const cards = document.querySelectorAll('#terminatedGrid .employee-card');
            const searchLower = searchTerm.toLowerCase();
            let visibleCount = 0;
            
            cards.forEach(card => {
                const searchData = card.getAttribute('data-search').toLowerCase();
                const isVisible = searchData.includes(searchLower);
                card.style.display = isVisible ? 'block' : 'none';
                if (isVisible) visibleCount++;
            });
            
            const countElement = document.getElementById('terminatedCount');
            if (countElement) {
                countElement.textContent = visibleCount;
            }
        }

        function reactivateEmployee(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) {
                showToast('Funcionário não encontrado!', 'error');
                return;
            }
            
            showModal(`
                <div class="modal-header">
                    <h2>🔄 Reativar Funcionário</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <p><strong>Funcionário:</strong> ${emp.name}</p>
                    <p><strong>Cargo:</strong> ${emp.position}</p>
                    <p><strong>Matrícula:</strong> ${emp.matricula}</p>
                    <p><strong>Desligado em:</strong> ${formatDate(emp.terminationDate)}</p>
                    <p><strong>Motivo:</strong> ${getTerminationReasonText(emp.terminationReason)}</p>
                </div>
                
                <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin: 20px 0; color: #155724;">
                    <strong>✅ Reativação:</strong> O funcionário voltará para a lista de funcionários ativos e poderá receber novos benefícios.
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button class="btn btn-success" onclick="executeReactivation(${id})">🔄 Confirmar Reativação</button>
                </div>
            `);
        }

        function executeReactivation(id) {
            const empIndex = employees.findIndex(e => e.id === id);
            if (empIndex === -1) {
                showToast('Funcionário não encontrado!', 'error');
                return;
            }
            
            try {
                const emp = employees[empIndex];
                
                // Reactivate employee
                employees[empIndex].status = 'active';
                employees[empIndex].terminationDate = null;
                employees[empIndex].terminationReason = null;
                employees[empIndex].terminationNotes = null;
                
                closeModal();
                showToast(`✅ ${emp.name} foi reativado com sucesso!`);
                
                // Refresh current view
                if (currentTab === 'terminated') {
                    renderTerminated();
                } else if (currentTab === 'employees') {
                    renderEmployees();
                } else if (currentTab === 'dashboard') {
                    renderDashboard();
                } else {
                    showTab('dashboard');
                }
                
            } catch (error) {
                console.error('Erro ao reativar funcionário:', error);
                showToast('Erro ao reativar funcionário!', 'error');
            }
        }

        function confirmPermanentDelete(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) return;
            
            showConfirmation(
                `⚠️ ATENÇÃO: Tem certeza que deseja EXCLUIR PERMANENTEMENTE o funcionário "${emp.name}"? Esta ação não pode ser desfeita e todos os dados relacionados (benefícios, vales) também serão perdidos.`,
                () => permanentDeleteEmployee(id)
            );
        }

        function permanentDeleteEmployee(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) {
                showToast('Funcionário não encontrado!', 'error');
                return;
            }
            
            try {
                // Remove employee
                const empIndex = employees.findIndex(e => e.id === id);
                if (empIndex === -1) {
                    showToast('Funcionário não encontrado!', 'error');
                    return;
                }
                
                const deletedEmployee = employees[empIndex];
                employees.splice(empIndex, 1);
                
                // Remove related benefits
                const deletedBenefits = benefits.filter(b => b.employeeId === id);
                benefits = benefits.filter(b => b.employeeId !== id);
                
                // Remove related vales
                const deletedVales = vales.filter(v => v.employeeId === id);
                vales = vales.filter(v => v.employeeId !== id);
                
                closeModal();
                showToast(`✅ ${deletedEmployee.name} foi excluído permanentemente! (${deletedBenefits.length} benefícios e ${deletedVales.length} vales também removidos)`);
                
                // Refresh current view
                if (currentTab === 'employees') {
                    renderEmployees();
                } else if (currentTab === 'terminated') {
                    renderTerminated();
                } else if (currentTab === 'dashboard') {
                    renderDashboard();
                } else {
                    showTab('dashboard');
                }
                
            } catch (error) {
                console.error('Erro ao excluir funcionário:', error);
                showToast('Erro ao excluir funcionário!', 'error');
            }
        }
        function renderEmployees() {
            const activeEmployees = employees.filter(e => e.status === 'active');
            
            document.getElementById('contentArea').innerHTML = `
                <h1 style="margin-bottom: 30px; color: #333;">👥 Gestão de Funcionários</h1>
                
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="🔍 Buscar funcionários..." oninput="filterEmployees(this.value)" value="${currentSearchTerm}">
                    <button class="btn btn-primary" onclick="addEmployee()">+ Adicionar Funcionário</button>
                </div>
                
                <p style="margin-bottom: 20px; color: #666;">
                    <strong id="employeeCount">${activeEmployees.length}</strong> funcionários encontrados
                </p>
                
                <div class="employee-grid" id="employeeGrid">
                    ${renderEmployeeCards(activeEmployees)}
                </div>
            `;
            
            // Apply current search filter
            if (currentSearchTerm) {
                filterEmployees(currentSearchTerm);
            }
        }

        function renderEmployeeCards(employeeList) {
            return employeeList.map(emp => `
                <div class="employee-card" data-search="${emp.name} ${emp.position} ${emp.matricula} ${emp.team}">
                    <div class="employee-header">
                        <div class="employee-avatar">
                            ${getInitials(emp.name)}
                        </div>
                        <div class="employee-info">
                            <div class="employee-name">${emp.name}</div>
                            <div class="employee-position">${emp.position}</div>
                            <span class="status-badge ${emp.contractType === 'experience' ? 'status-experience' : 'status-active'}">
                                ${emp.contractType === 'experience' ? 'Experiência' : 'CLT'}
                            </span>
                        </div>
                    </div>
                    
                    <div class="employee-details">
                        <div class="detail-item">
                            <span class="detail-label">Matrícula:</span>
                            <span class="detail-value">${emp.matricula}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Equipe:</span>
                            <span class="detail-value">${emp.team}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Salário:</span>
                            <span class="detail-value">R$ ${emp.salary.toLocaleString('pt-BR')}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Admissão:</span>
                            <span class="detail-value">${formatDate(emp.admission)}</span>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 5px;">
                        <button class="btn btn-secondary" onclick="viewEmployee(${emp.id})" style="flex: 1; font-size: 0.9em;">👁️ Ver</button>
                        <button class="btn btn-primary" onclick="editEmployee(${emp.id})" style="flex: 1; font-size: 0.9em;">✏️ Editar</button>
                        <button class="btn btn-danger" onclick="confirmDeleteEmployee(${emp.id})" style="flex: 1; font-size: 0.9em;">🗑️ Excluir</button>
                    </div>
                </div>
            `).join('');
        }

        // Vacation
        function renderVacation() {
            const vacationDue = getVacationDue();
            
            document.getElementById('contentArea').innerHTML = `
                <h1 style="margin-bottom: 30px; color: #333;">🏖️ Controle de Férias</h1>
                
                ${vacationDue.length > 0 ? `
                    <p style="margin-bottom: 20px; color: #666;">
                        <strong>${vacationDue.length}</strong> funcionário${vacationDue.length > 1 ? 's' : ''} com férias a vencer nos próximos 90 dias
                    </p>
                    <div class="employee-grid">
                        ${vacationDue.map(emp => `
                            <div class="employee-card" style="border-left: 4px solid ${emp.daysUntil <= 30 ? '#dc3545' : '#ffc107'};">
                                <div class="employee-header">
                                    <div class="employee-avatar">
                                        ${getInitials(emp.name)}
                                    </div>
                                    <div class="employee-info">
                                        <div class="employee-name">${emp.name}</div>
                                        <div class="employee-position">${emp.position}</div>
                                    </div>
                                </div>
                                
                                <div class="employee-details">
                                    <div class="detail-item">
                                        <span class="detail-label">Admissão:</span>
                                        <span class="detail-value">${formatDate(emp.admission)}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Última férias:</span>
                                        <span class="detail-value">${emp.lastVacation ? formatDate(emp.lastVacation) : 'Nunca'}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Vencimento:</span>
                                        <span class="detail-value">${formatDate(emp.nextVacationDate)}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Dias restantes:</span>
                                        <span class="detail-value" style="color: ${emp.daysUntil <= 30 ? '#dc3545' : '#ffc107'}; font-weight: bold;">
                                            ${emp.daysUntil} dias
                                        </span>
                                    </div>
                                </div>
                                
                                <button class="btn btn-success" onclick="markVacationTaken(${emp.id})" style="width: 100%;">
                                    ✅ Marcar Férias Concluídas
                                </button>
                            </div>
                        `).join('')}
                    </div>
                ` : `
                    <div style="text-align: center; padding: 60px; color: #666;">
                        <div style="font-size: 4em; margin-bottom: 20px;">🎉</div>
                        <h3 style="color: #28a745;">Todas as férias estão em dia!</h3>
                        <p>Nenhum funcionário CLT precisa tirar férias nos próximos 90 dias.</p>
                    </div>
                `}
            `;
        }

        // Experience
        function renderExperience() {
            const experienceExpiring = getExperienceExpiring();
            
            document.getElementById('contentArea').innerHTML = `
                <h1 style="margin-bottom: 30px; color: #333;">⏰ Contratos de Experiência</h1>
                
                ${experienceExpiring.length > 0 ? `
                    <p style="margin-bottom: 20px; color: #666;">
                        <strong>${experienceExpiring.length}</strong> contrato${experienceExpiring.length > 1 ? 's' : ''} de experiência vencendo nos próximos 30 dias
                    </p>
                    <div class="employee-grid">
                        ${experienceExpiring.map(emp => `
                            <div class="employee-card" style="border-left: 4px solid ${emp.daysUntil <= 7 ? '#dc3545' : '#ffc107'};">
                                <div class="employee-header">
                                    <div class="employee-avatar">
                                        ${getInitials(emp.name)}
                                    </div>
                                    <div class="employee-info">
                                        <div class="employee-name">${emp.name}</div>
                                        <div class="employee-position">${emp.position}</div>
                                    </div>
                                </div>
                                
                                <div class="employee-details">
                                    <div class="detail-item">
                                        <span class="detail-label">Admissão:</span>
                                        <span class="detail-value">${formatDate(emp.admission)}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Vencimento:</span>
                                        <span class="detail-value">${formatDate(emp.experienceEndDate)}</span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Dias restantes:</span>
                                        <span class="detail-value" style="color: ${emp.daysUntil <= 7 ? '#dc3545' : '#ffc107'}; font-weight: bold;">
                                            ${emp.daysUntil} dias
                                        </span>
                                    </div>
                                    <div class="detail-item">
                                        <span class="detail-label">Status:</span>
                                        <span class="detail-value">
                                            ${emp.daysUntil <= 7 ? '🚨 Urgente' : '⚠️ Atenção'}
                                        </span>
                                    </div>
                                </div>
                                
                                <div style="display: flex; gap: 10px;">
                                    <button class="btn btn-success" onclick="renewContract(${emp.id})" style="flex: 1;">
                                        ✅ Efetivar
                                    </button>
                                    <button class="btn btn-warning" onclick="extendContract(${emp.id})" style="flex: 1;">
                                        ⏰ Prorrogar
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                ` : `
                    <div style="text-align: center; padding: 60px; color: #666;">
                        <div style="font-size: 4em; margin-bottom: 20px;">✅</div>
                        <h3 style="color: #28a745;">Todos os contratos estão em dia!</h3>
                        <p>Nenhum contrato de experiência vence nos próximos 30 dias.</p>
                    </div>
                `}
            `;
        }

        // Benefits
        function renderBenefits() {
            const activeBenefits = benefits.filter(b => b.status === 'active');
            
            document.getElementById('contentArea').innerHTML = `
                <h1 style="margin-bottom: 30px; color: #333;">🎁 Gestão de Benefícios</h1>
                
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="🔍 Buscar benefícios..." oninput="filterTable(this.value, 'benefitsTable')">
                    <button class="btn btn-primary" onclick="addBenefit()">+ Novo Benefício</button>
                </div>
                
                <p style="margin-bottom: 20px; color: #666;">
                    <strong>${activeBenefits.length}</strong> benefícios ativos
                </p>
                
                <div class="table-container">
                    <table id="benefitsTable">
                        <thead>
                            <tr>
                                <th>Funcionário</th>
                                <th>Tipo</th>
                                <th>Valor Mensal</th>
                                <th>Período</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${activeBenefits.map(benefit => `
                                <tr data-search="${benefit.employeeName} ${benefit.type}">
                                    <td><strong>${benefit.employeeName}</strong></td>
                                    <td>
                                        ${getBenefitTypeIcon(benefit.type)} ${getBenefitTypeName(benefit.type)}
                                    </td>
                                    <td><strong>R$ ${benefit.value.toLocaleString('pt-BR')}</strong></td>
                                    <td>${formatDate(benefit.startDate)} - ${formatDate(benefit.endDate)}</td>
                                    <td>
                                        <button class="btn btn-secondary" onclick="viewBenefit(${benefit.id})">👁️ Ver</button>
                                        <button class="btn btn-danger" onclick="confirmDeleteBenefit(${benefit.id})">🗑️ Excluir</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Vales
        function renderVales() {
            document.getElementById('contentArea').innerHTML = `
                <h1 style="margin-bottom: 30px; color: #333;">💳 Gestão de Vales</h1>
                
                <div class="search-bar">
                    <input type="text" class="search-input" placeholder="🔍 Buscar vales..." oninput="filterTable(this.value, 'valesTable')">
                    <button class="btn btn-primary" onclick="addVale()">+ Novo Vale</button>
                </div>
                
                <p style="margin-bottom: 20px; color: #666;">
                    <strong>${vales.length}</strong> vales cadastrados
                </p>
                
                <div class="table-container">
                    <table id="valesTable">
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Funcionário</th>
                                <th>Tipo</th>
                                <th>Valor</th>
                                <th>Descrição</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${vales.map(vale => `
                                <tr data-search="${vale.employeeName} ${vale.type} ${vale.description}">
                                    <td>${formatDate(vale.date)}</td>
                                    <td><strong>${vale.employeeName}</strong></td>
                                    <td>
                                        ${getValeTypeIcon(vale.type)} ${getValeTypeName(vale.type)}
                                    </td>
                                    <td><strong>R$ ${vale.value.toLocaleString('pt-BR')}</strong></td>
                                    <td>${vale.description}</td>
                                    <td>
                                        <button class="btn btn-secondary" onclick="viewVale(${vale.id})">👁️ Ver</button>
                                        <button class="btn btn-danger" onclick="confirmDeleteVale(${vale.id})">🗑️ Excluir</button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }

        // Reports
        function renderReports() {
            document.getElementById('contentArea').innerHTML = `
                <h1 style="margin-bottom: 30px; color: #333;">📈 Central de Relatórios</h1>
                
                <div class="dashboard-grid">
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 15px;">📋</div>
                        <h3>Relatório de Funcionários</h3>
                        <p style="color: #666; margin: 15px 0;">Lista completa de funcionários ativos</p>
                        <button class="btn btn-primary" onclick="downloadReport('employees')">📥 Baixar CSV</button>
                    </div>
                    
                        <div style="background: #f8f9fa; padding: 30px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 15px;">🚪</div>
                        <h3>Relatório de Desligados</h3>
                        <p style="color: #666; margin: 15px 0;">Histórico de funcionários desligados</p>
                        <button class="btn btn-primary" onclick="downloadReport('terminated')">📥 Baixar CSV</button>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 15px;">💳</div>
                        <h3>Relatório de Vales</h3>
                        <p style="color: #666; margin: 15px 0;">Histórico de vales emitidos</p>
                        <button class="btn btn-primary" onclick="downloadReport('vales')">📥 Baixar CSV</button>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 15px;">🎁</div>
                        <h3>Relatório de Benefícios</h3>
                        <p style="color: #666; margin: 15px 0;">Benefícios ativos por funcionário</p>
                        <button class="btn btn-primary" onclick="downloadReport('benefits')">📥 Baixar CSV</button>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 15px; text-align: center;">
                        <div style="font-size: 3em; margin-bottom: 15px;">💾</div>
                        <h3>Backup Completo</h3>
                        <p style="color: #666; margin: 15px 0;">Backup de todos os dados</p>
                        <button class="btn btn-success" onclick="createBackup()">💾 Fazer Backup</button>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="margin-bottom: 20px; color: #333;">📊 Relatórios Analíticos</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                            <h4>💰 Resumo Financeiro</h4>
                            <div style="margin-top: 15px;">
                                <p><strong>Folha Salarial:</strong> R$ ${employees.filter(e => e.status === 'active').reduce((sum, e) => sum + e.salary, 0).toLocaleString('pt-BR')}</p>
                                <p><strong>Total Benefícios:</strong> R$ ${benefits.filter(b => b.status === 'active').reduce((sum, b) => sum + b.value, 0).toLocaleString('pt-BR')}</p>
                                <p><strong>Total Vales:</strong> R$ ${vales.reduce((sum, v) => sum + v.value, 0).toLocaleString('pt-BR')}</p>
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                            <h4>👥 Distribuição de Funcionários</h4>
                            <div style="margin-top: 15px;">
                                <p><strong>Ativos:</strong> ${employees.filter(e => e.status === 'active').length}</p>
                                <p><strong>Desligados:</strong> ${employees.filter(e => e.status === 'terminated').length}</p>
                                <p><strong>CLT:</strong> ${employees.filter(e => e.contractType === 'permanent' && e.status === 'active').length}</p>
                                <p><strong>Experiência:</strong> ${employees.filter(e => e.contractType === 'experience' && e.status === 'active').length}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Settings
        function renderSettings() {
            document.getElementById('contentArea').innerHTML = `
                <h1 style="margin-bottom: 30px; color: #333;">⚙️ Configurações do Sistema</h1>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 15px;">
                        <h3 style="margin-bottom: 20px;">👤 Usuários do Sistema</h3>
                        <p style="color: #666; margin-bottom: 20px;">Gerencie usuários com acesso ao sistema</p>
                        <button class="btn btn-primary" onclick="addUser()">+ Adicionar Usuário</button>
                        
                        <div style="margin-top: 20px;">
                            ${systemUsers.map(user => `
                                <div style="background: white; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #00a8a8;">
                                    <div style="display: flex; justify-content: between; align-items: center;">
                                        <div style="flex: 1;">
                                            <div style="font-weight: bold;">${user.name}</div>
                                            <div style="color: #666; font-size: 0.9em;">${user.email}</div>
                                            <div style="color: #666; font-size: 0.8em;">
                                                ${user.role === 'admin' ? '🔑 Administrador' : '👨‍💼 Usuário'}
                                            </div>
                                        </div>
                                        ${user.id !== 1 ? `
                                            <button class="btn btn-danger" onclick="confirmDeleteUser(${user.id})" style="padding: 5px 10px; font-size: 0.8em;">🗑️</button>
                                        ` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 15px;">
                        <h3 style="margin-bottom: 20px;">📥 Importar Funcionários</h3>
                        <p style="color: #666; margin-bottom: 20px;">Importe múltiplos funcionários via CSV</p>
                        
                        <div class="file-upload" onclick="document.getElementById('csvFile').click()">
                            <div style="font-size: 2em; margin-bottom: 10px;">📄</div>
                            <p>Clique para selecionar arquivo CSV</p>
                            <input type="file" id="csvFile" accept=".csv" style="display: none;" onchange="handleCsvImport(event)">
                        </div>
                        
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-top: 15px; font-size: 0.9em;">
                            <strong>📋 Formato esperado do CSV:</strong><br>
                            <code>matricula,nome,cargo,equipe,salario,contrato,email,telefone,cidade,admissao,tipo_contrato</code><br><br>
                            <strong>📝 Exemplo de linha:</strong><br>
                            <code>CT0001,JOÃO DA SILVA,CONSULTOR DE VENDAS,VENDAS,2500,CLT,joao@email.com,(62)99999-9999,GOIÂNIA,2024-01-15,CLT</code><br><br>
                            <strong>ℹ️ Dicas importantes:</strong><br>
                            • Use vírgula como separador<br>
                            • Data no formato YYYY-MM-DD ou DD/MM/YYYY<br>
                            • Tipo contrato: "CLT" ou "Experiencia"<br>
                            • Campos obrigatórios: matricula, nome, cargo
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 15px;">
                        <h3 style="margin-bottom: 20px;">💾 Backup & Restore</h3>
                        <p style="color: #666; margin-bottom: 20px;">Proteja seus dados com backup</p>
                        
                        <button class="btn btn-success" onclick="createBackup()" style="width: 100%; margin-bottom: 10px;">
                            💾 Criar Backup
                        </button>
                        
                        <div class="file-upload" onclick="document.getElementById('backupFile').click()">
                            <div style="font-size: 1.5em; margin-bottom: 5px;">📁</div>
                            <p style="font-size: 0.9em;">Restaurar Backup</p>
                            <input type="file" id="backupFile" accept=".json" style="display: none;" onchange="handleBackupRestore(event)">
                        </div>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 30px; border-radius: 15px;">
                        <h3 style="margin-bottom: 20px;">📊 Estatísticas</h3>
                        <div style="display: grid; gap: 15px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>👥 Ativos</span>
                                <strong>${employees.filter(e => e.status === 'active').length}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>🚪 Desligados</span>
                                <strong>${employees.filter(e => e.status === 'terminated').length}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>💳 Vales</span>
                                <strong>${vales.length}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>🎁 Benefícios</span>
                                <strong>${benefits.filter(b => b.status === 'active').length}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <span>👤 Usuários</span>
                                <strong>${systemUsers.length}</strong>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Helper Functions
        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').substring(0, 2);
        }

        function getTeamStats() {
            const teams = {};
            employees.filter(e => e.status === 'active').forEach(emp => {
                teams[emp.team] = (teams[emp.team] || 0) + 1;
            });
            return Object.entries(teams).map(([name, count]) => ({ name, count }));
        }

        function getBenefitTypeIcon(type) {
            const icons = {
                'vale_alimentacao': '🍽️',
                'vale_transporte': '🚗',
                'plano_saude': '🏥',
                'plano_odontologico': '🦷'
            };
            return icons[type] || '🎁';
        }

        function getBenefitTypeName(type) {
            const names = {
                'vale_alimentacao': 'Vale Alimentação',
                'vale_transporte': 'Vale Transporte',
                'plano_saude': 'Plano de Saúde',
                'plano_odontologico': 'Plano Odontológico'
            };
            return names[type] || type;
        }

        function getValeTypeIcon(type) {
            const icons = {
                'alimentacao': '🍽️',
                'transporte': '🚗',
                'combustivel': '⛽',
                'refeicao': '🍴'
            };
            return icons[type] || '💳';
        }

        function getValeTypeName(type) {
            const names = {
                'alimentacao': 'Alimentação',
                'transporte': 'Transporte',
                'combustivel': 'Combustível',
                'refeicao': 'Refeição'
            };
            return names[type] || type;
        }

        function getVacationDue() {
            const today = new Date();
            const vacationDue = [];
            
            employees.filter(e => e.status === 'active' && e.contractType === 'permanent').forEach(emp => {
                const admissionDate = new Date(emp.admission);
                const lastVacationDate = emp.lastVacation ? new Date(emp.lastVacation) : admissionDate;
                
                const nextVacationDate = new Date(lastVacationDate);
                nextVacationDate.setFullYear(nextVacationDate.getFullYear() + 1);
                
                const daysUntilVacation = Math.ceil((nextVacationDate - today) / (1000 * 60 * 60 * 24));
                
                if (daysUntilVacation <= 90 && daysUntilVacation >= 0) {
                    vacationDue.push({
                        ...emp,
                        nextVacationDate: nextVacationDate.toISOString().split('T')[0],
                        daysUntil: daysUntilVacation
                    });
                }
            });
            
            return vacationDue.sort((a, b) => a.daysUntil - b.daysUntil);
        }

        function getExperienceExpiring() {
            const today = new Date();
            const experienceExpiring = [];
            
            employees.filter(e => e.status === 'active' && e.contractType === 'experience').forEach(emp => {
                const admissionDate = new Date(emp.admission);
                const experienceEndDate = new Date(admissionDate);
                experienceEndDate.setDate(experienceEndDate.getDate() + 90);
                
                const daysUntilExpiration = Math.ceil((experienceEndDate - today) / (1000 * 60 * 60 * 24));
                
                if (daysUntilExpiration <= 30 && daysUntilExpiration >= 0) {
                    experienceExpiring.push({
                        ...emp,
                        experienceEndDate: experienceEndDate.toISOString().split('T')[0],
                        daysUntil: daysUntilExpiration
                    });
                }
            });
            
            return experienceExpiring.sort((a, b) => a.daysUntil - b.daysUntil);
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type} show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        function showModal(content) {
            document.getElementById('modalContent').innerHTML = content;
            document.getElementById('modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
        }

        function showConfirmation(message, onConfirm, onCancel) {
            const overlay = document.createElement('div');
            overlay.className = 'confirmation-dialog';
            overlay.innerHTML = `
                <div class="confirmation-content">
                    <h3 style="margin-bottom: 20px; color: #333;">⚠️ Confirmação</h3>
                    <p style="margin-bottom: 30px; color: #666;">${message}</p>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button class="btn btn-secondary" onclick="closeConfirmation()">Cancelar</button>
                        <button class="btn btn-danger" onclick="confirmAction()">Confirmar</button>
                    </div>
                </div>
            `;
            
            overlay.querySelector('.btn-secondary').onclick = () => {
                document.body.removeChild(overlay);
                if (onCancel) onCancel();
            };
            
            overlay.querySelector('.btn-danger').onclick = () => {
                document.body.removeChild(overlay);
                if (onConfirm) onConfirm();
            };
            
            document.body.appendChild(overlay);
        }

        // Filter Functions
        function filterEmployees(searchTerm) {
            currentSearchTerm = searchTerm;
            const cards = document.querySelectorAll('#employeeGrid .employee-card');
            const searchLower = searchTerm.toLowerCase();
            let visibleCount = 0;
            
            cards.forEach(card => {
                const searchData = card.getAttribute('data-search').toLowerCase();
                const isVisible = searchData.includes(searchLower);
                card.style.display = isVisible ? 'block' : 'none';
                if (isVisible) visibleCount++;
            });
            
            const countElement = document.getElementById('employeeCount');
            if (countElement) {
                countElement.textContent = visibleCount;
            }
        }

        function filterTable(searchTerm, tableId) {
            const table = document.getElementById(tableId);
            if (!table) return;
            
            const rows = table.querySelectorAll('tbody tr');
            const searchLower = searchTerm.toLowerCase();
            
            rows.forEach(row => {
                const searchData = row.getAttribute('data-search').toLowerCase();
                row.style.display = searchData.includes(searchLower) ? '' : 'none';
            });
        }

        // Employee Functions
        function addEmployee() {
            const existingNumbers = employees.map(emp => {
                const match = emp.matricula.match(/CT(\d+)/);
                return match ? parseInt(match[1]) : 0;
            });
            const maxNumber = Math.max(...existingNumbers, 0);
            const suggestedMatricula = `CT${String(maxNumber + 1).padStart(4, '0')}`;
            
            showModal(`
                <div class="modal-header">
                    <h2>👤 Adicionar Funcionário</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <form onsubmit="createEmployee(event)">
                    <div class="form-group">
                        <label class="form-label">Matrícula</label>
                        <input type="text" class="form-control" name="matricula" value="${suggestedMatricula}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nome Completo</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cargo</label>
                        <select class="form-control" name="position" required>
                            <option value="">Selecione o cargo</option>
                            <option value="ESTAGIO/VENDAS">ESTAGIO/VENDAS</option>
                            <option value="CONSULTOR DE VENDAS">CONSULTOR DE VENDAS</option>
                            <option value="SUPERVISOR DE VENDAS">SUPERVISOR DE VENDAS</option>
                            <option value="QUALIDADE ESTAGIO">QUALIDADE ESTAGIO</option>
                            <option value="ANALISTA">ANALISTA</option>
                            <option value="COORDENADOR">COORDENADOR</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Equipe</label>
                        <select class="form-control" name="team" required>
                            <option value="">Selecione a equipe</option>
                            <option value="ISABELA">ISABELA</option>
                            <option value="VENDAS">VENDAS</option>
                            <option value="QUALIDADE">QUALIDADE</option>
                            <option value="ADMINISTRATIVA">ADMINISTRATIVA</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Salário</label>
                        <input type="number" class="form-control" name="salary" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo de Contrato</label>
                        <select class="form-control" name="contractType" required>
                            <option value="">Selecione</option>
                            <option value="experience">Experiência</option>
                            <option value="permanent">CLT</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contrato</label>
                        <select class="form-control" name="contract" required>
                            <option value="">Selecione</option>
                            <option value="CLT">CLT</option>
                            <option value="MAIS TALENTOS">MAIS TALENTOS</option>
                            <option value="TERCEIRIZADO">TERCEIRIZADO</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Telefone</label>
                        <input type="tel" class="form-control" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cidade</label>
                        <input type="text" class="form-control" name="city" value="GOIÂNIA" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Admissão</label>
                        <input type="date" class="form-control" name="admission" value="${new Date().toISOString().split('T')[0]}" required>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                        <button type="submit" class="btn btn-success">💾 Salvar</button>
                    </div>
                </form>
            `);
        }

        function createEmployee(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            const matricula = formData.get('matricula').toUpperCase();
            
            if (employees.some(emp => emp.matricula === matricula)) {
                showToast('Esta matrícula já existe!', 'error');
                return;
            }
            
            const newEmployee = {
                id: Date.now(),
                matricula: matricula,
                name: formData.get('name').toUpperCase(),
                position: formData.get('position'),
                team: formData.get('team'),
                admission: formData.get('admission'),
                salary: parseFloat(formData.get('salary')),
                contract: formData.get('contract'),
                city: formData.get('city').toUpperCase(),
                phone: formData.get('phone'),
                email: formData.get('email').toLowerCase(),
                status: 'active',
                lastVacation: null,
                contractType: formData.get('contractType')
            };
            
            employees.push(newEmployee);
            closeModal();
            showToast(`Funcionário ${newEmployee.name} cadastrado com sucesso!`);
            
            // Refresh current view
            if (currentTab === 'employees') {
                renderEmployees();
            } else {
                showTab('dashboard');
            }
        }

        function viewEmployee(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) return;
            
            showModal(`
                <div class="modal-header">
                    <h2>👤 ${emp.name}</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <p><strong>Matrícula:</strong> ${emp.matricula}</p>
                        <p><strong>Cargo:</strong> ${emp.position}</p>
                        <p><strong>Equipe:</strong> ${emp.team}</p>
                        <p><strong>Contrato:</strong> ${emp.contract}</p>
                        <p><strong>Tipo:</strong> ${emp.contractType === 'experience' ? 'Experiência' : 'CLT'}</p>
                    </div>
                    <div>
                        <p><strong>Salário:</strong> R$ ${emp.salary.toLocaleString('pt-BR')}</p>
                        <p><strong>Email:</strong> ${emp.email}</p>
                        <p><strong>Telefone:</strong> ${emp.phone}</p>
                        <p><strong>Cidade:</strong> ${emp.city}</p>
                        <p><strong>Admissão:</strong> ${formatDate(emp.admission)}</p>
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="editEmployee(${emp.id})">✏️ Editar</button>
                    <button class="btn btn-secondary" onclick="closeModal()">Fechar</button>
                </div>
            `);
        }

        function editEmployee(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) return;
            
            showModal(`
                <div class="modal-header">
                    <h2>✏️ Editar Funcionário</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <form onsubmit="updateEmployee(event, ${emp.id})">
                    <div class="form-group">
                        <label class="form-label">Nome Completo</label>
                        <input type="text" class="form-control" name="name" value="${emp.name}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cargo</label>
                        <select class="form-control" name="position" required>
                            <option value="ESTAGIO/VENDAS" ${emp.position === 'ESTAGIO/VENDAS' ? 'selected' : ''}>ESTAGIO/VENDAS</option>
                            <option value="CONSULTOR DE VENDAS" ${emp.position === 'CONSULTOR DE VENDAS' ? 'selected' : ''}>CONSULTOR DE VENDAS</option>
                            <option value="SUPERVISOR DE VENDAS" ${emp.position === 'SUPERVISOR DE VENDAS' ? 'selected' : ''}>SUPERVISOR DE VENDAS</option>
                            <option value="QUALIDADE ESTAGIO" ${emp.position === 'QUALIDADE ESTAGIO' ? 'selected' : ''}>QUALIDADE ESTAGIO</option>
                            <option value="ANALISTA" ${emp.position === 'ANALISTA' ? 'selected' : ''}>ANALISTA</option>
                            <option value="COORDENADOR" ${emp.position === 'COORDENADOR' ? 'selected' : ''}>COORDENADOR</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Equipe</label>
                        <select class="form-control" name="team" required>
                            <option value="ISABELA" ${emp.team === 'ISABELA' ? 'selected' : ''}>ISABELA</option>
                            <option value="VENDAS" ${emp.team === 'VENDAS' ? 'selected' : ''}>VENDAS</option>
                            <option value="QUALIDADE" ${emp.team === 'QUALIDADE' ? 'selected' : ''}>QUALIDADE</option>
                            <option value="ADMINISTRATIVA" ${emp.team === 'ADMINISTRATIVA' ? 'selected' : ''}>ADMINISTRATIVA</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Salário</label>
                        <input type="number" class="form-control" name="salary" value="${emp.salary}" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" name="email" value="${emp.email}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Telefone</label>
                        <input type="tel" class="form-control" name="phone" value="${emp.phone}" required>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                        <button type="submit" class="btn btn-success">💾 Salvar</button>
                    </div>
                </form>
            `);
        }

        function updateEmployee(event, id) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const empIndex = employees.findIndex(e => e.id === id);
            
            if (empIndex > -1) {
                employees[empIndex].name = formData.get('name').toUpperCase();
                employees[empIndex].position = formData.get('position');
                employees[empIndex].team = formData.get('team');
                employees[empIndex].salary = parseFloat(formData.get('salary'));
                employees[empIndex].email = formData.get('email').toLowerCase();
                employees[empIndex].phone = formData.get('phone');
                
                closeModal();
                showToast('Funcionário atualizado com sucesso!');
                
                // Refresh current view
                if (currentTab === 'employees') {
                    renderEmployees();
                } else {
                    showTab('dashboard');
                }
            }
        }

        function confirmDeleteEmployee(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) {
                showToast('Funcionário não encontrado!', 'error');
                return;
            }
            
            showModal(`
                <div class="modal-header">
                    <h2>⚠️ Escolha a Ação</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <p><strong>Funcionário:</strong> ${emp.name}</p>
                    <p><strong>Cargo:</strong> ${emp.position}</p>
                    <p><strong>Matrícula:</strong> ${emp.matricula}</p>
                </div>
                
                <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 20px 0;">
                    <h4 style="margin: 0 0 10px 0;">Escolha uma das opções:</h4>
                    <p style="margin: 5px 0;"><strong>🚪 Desligar:</strong> Move para aba "Desligados" (recomendado)</p>
                    <p style="margin: 5px 0;"><strong>🗑️ Excluir:</strong> Remove permanentemente do sistema</p>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button class="btn btn-warning" onclick="showTerminateForm(${emp.id})">🚪 Desligar</button>
                    <button class="btn btn-danger" onclick="confirmPermanentDeleteEmployee(${emp.id})">🗑️ Excluir</button>
                </div>
            `);
        }

        function showTerminateForm(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) return;
            
            showModal(`
                <div class="modal-header">
                    <h2>🚪 Desligar Funcionário</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <p><strong>Funcionário:</strong> ${emp.name}</p>
                    <p><strong>Cargo:</strong> ${emp.position}</p>
                    <p><strong>Matrícula:</strong> ${emp.matricula}</p>
                </div>
                
                <form onsubmit="terminateEmployee(event, ${emp.id})">
                    <div class="form-group">
                        <label class="form-label">Data do Desligamento</label>
                        <input type="date" class="form-control" name="terminationDate" value="${new Date().toISOString().split('T')[0]}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Motivo do Desligamento</label>
                        <select class="form-control" name="terminationReason" required>
                            <option value="">Selecione o motivo</option>
                            <option value="demissao_sem_justa_causa">Demissão sem justa causa</option>
                            <option value="demissao_com_justa_causa">Demissão com justa causa</option>
                            <option value="pedido_demissao">Pedido de demissão</option>
                            <option value="fim_contrato">Fim de contrato</option>
                            <option value="aposentadoria">Aposentadoria</option>
                            <option value="falecimento">Falecimento</option>
                            <option value="outros">Outros</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Observações (opcional)</label>
                        <textarea class="form-control" name="terminationNotes" rows="3" placeholder="Informações adicionais sobre o desligamento..."></textarea>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px 0; color: #856404;">
                        <strong>⚠️ Atenção:</strong> O funcionário será movido para a aba "Desligados" e não aparecerá mais nos relatórios de funcionários ativos.
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                        <button type="submit" class="btn btn-warning">🚪 Confirmar Desligamento</button>
                    </div>
                </form>
            `);
        }

        function confirmPermanentDeleteEmployee(id) {
            const emp = employees.find(e => e.id === id);
            if (!emp) {
                showToast('Funcionário não encontrado!', 'error');
                return;
            }
            
            showModal(`
                <div class="modal-header">
                    <h2>🗑️ Excluir Permanentemente</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <p><strong>Funcionário:</strong> ${emp.name}</p>
                    <p><strong>Cargo:</strong> ${emp.position}</p>
                    <p><strong>Matrícula:</strong> ${emp.matricula}</p>
                </div>
                
                <div style="background: #f8d7da; padding: 15px; border-radius: 8px; margin: 20px 0; color: #721c24;">
                    <h4 style="margin: 0 0 10px 0;">⚠️ ATENÇÃO - EXCLUSÃO PERMANENTE</h4>
                    <p style="margin: 5px 0;">Esta ação NÃO PODE ser desfeita!</p>
                    <p style="margin: 5px 0;">O funcionário e todos os dados relacionados serão perdidos:</p>
                    <ul style="margin: 10px 0; padding-left: 20px;">
                        <li>Dados pessoais e contratuais</li>
                        <li>Histórico de benefícios</li>
                        <li>Histórico de vales</li>
                        <li>Todas as informações relacionadas</li>
                    </ul>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Digite "EXCLUIR" para confirmar:</label>
                    <input type="text" class="form-control" id="confirmDeleteText" placeholder="Digite EXCLUIR" onkeyup="checkDeleteConfirmation(${id})">
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button class="btn btn-danger" id="confirmDeleteBtn" onclick="permanentDeleteEmployee(${id})" disabled>🗑️ Excluir Permanentemente</button>
                </div>
            `);
        }

        function checkDeleteConfirmation(id) {
            const input = document.getElementById('confirmDeleteText');
            const btn = document.getElementById('confirmDeleteBtn');
            
            if (input && btn) {
                if (input.value.toUpperCase() === 'EXCLUIR') {
                    btn.disabled = false;
                    btn.style.opacity = '1';
                } else {
                    btn.disabled = true;
                    btn.style.opacity = '0.5';
                }
            }
        }

        function terminateEmployee(event, id) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            const empIndex = employees.findIndex(e => e.id === id);
            if (empIndex === -1) {
                showToast('Funcionário não encontrado!', 'error');
                return;
            }
            
            try {
                const emp = employees[empIndex];
                
                // Update employee status
                employees[empIndex].status = 'terminated';
                employees[empIndex].terminationDate = formData.get('terminationDate');
                employees[empIndex].terminationReason = formData.get('terminationReason');
                employees[empIndex].terminationNotes = formData.get('terminationNotes');
                
                // Inactivate related benefits
                let inactivatedBenefits = 0;
                benefits.forEach(benefit => {
                    if (benefit.employeeId === id && benefit.status === 'active') {
                        benefit.status = 'inactive';
                        benefit.endDate = formData.get('terminationDate');
                        inactivatedBenefits++;
                    }
                });
                
                closeModal();
                showToast(`✅ ${emp.name} foi desligado e movido para "Desligados"! ${inactivatedBenefits > 0 ? `(${inactivatedBenefits} benefícios inativados)` : ''}`);
                
                // Refresh current view
                if (currentTab === 'employees') {
                    renderEmployees();
                } else if (currentTab === 'terminated') {
                    renderTerminated();
                } else if (currentTab === 'dashboard') {
                    renderDashboard();
                } else {
                    showTab('dashboard');
                }
                
            } catch (error) {
                console.error('Erro ao desligar funcionário:', error);
                showToast('Erro ao desligar funcionário!', 'error');
            }
        }

        // Benefits Functions
        function addBenefit() {
            const activeEmployees = employees.filter(e => e.status === 'active');
            
            showModal(`
                <div class="modal-header">
                    <h2>🎁 Adicionar Benefício</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <form onsubmit="createBenefit(event)">
                    <div class="form-group">
                        <label class="form-label">Funcionário</label>
                        <select class="form-control" name="employeeId" required>
                            <option value="">Selecione o funcionário</option>
                            ${activeEmployees.map(emp => 
                                `<option value="${emp.id}">${emp.name} (${emp.matricula})</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo de Benefício</label>
                        <select class="form-control" name="type" required>
                            <option value="">Selecione o tipo</option>
                            <option value="vale_alimentacao">🍽️ Vale Alimentação</option>
                            <option value="vale_transporte">🚗 Vale Transporte</option>
                            <option value="plano_saude">🏥 Plano de Saúde</option>
                            <option value="plano_odontologico">🦷 Plano Odontológico</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor Mensal (R$)</label>
                        <input type="number" class="form-control" name="value" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Início</label>
                        <input type="date" class="form-control" name="startDate" value="${new Date().toISOString().split('T')[0]}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Fim</label>
                        <input type="date" class="form-control" name="endDate" value="2025-12-31" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descrição</label>
                        <textarea class="form-control" name="description" rows="3"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                        <button type="submit" class="btn btn-success">💾 Salvar</button>
                    </div>
                </form>
            `);
        }

        function createBenefit(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            const employeeId = parseInt(formData.get('employeeId'));
            const employee = employees.find(e => e.id === employeeId);
            
            if (!employee) {
                showToast('Funcionário não encontrado!', 'error');
                return;
            }
            
            const newBenefit = {
                id: Date.now(),
                employeeId: employeeId,
                employeeName: employee.name,
                type: formData.get('type'),
                value: parseFloat(formData.get('value')),
                startDate: formData.get('startDate'),
                endDate: formData.get('endDate'),
                status: 'active',
                description: formData.get('description') || `Benefício ${getBenefitTypeName(formData.get('type'))}`
            };
            
            benefits.push(newBenefit);
            closeModal();
            showToast(`Benefício adicionado para ${employee.name}!`);
            
            // Refresh current view
            if (currentTab === 'benefits') {
                renderBenefits();
            } else {
                showTab('dashboard');
            }
        }

        function viewBenefit(id) {
            const benefit = benefits.find(b => b.id === id);
            if (!benefit) return;
            
            showModal(`
                <div class="modal-header">
                    <h2>🎁 Detalhes do Benefício</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <div style="display: grid; gap: 15px;">
                    <p><strong>Funcionário:</strong> ${benefit.employeeName}</p>
                    <p><strong>Tipo:</strong> ${getBenefitTypeIcon(benefit.type)} ${getBenefitTypeName(benefit.type)}</p>
                    <p><strong>Valor Mensal:</strong> R$ ${benefit.value.toLocaleString('pt-BR')}</p>
                    <p><strong>Período:</strong> ${formatDate(benefit.startDate)} até ${formatDate(benefit.endDate)}</p>
                    <p><strong>Descrição:</strong> ${benefit.description}</p>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="closeModal()">Fechar</button>
                </div>
            `);
        }

        function confirmDeleteBenefit(id) {
            const benefit = benefits.find(b => b.id === id);
            if (!benefit) {
                showToast('Benefício não encontrado!', 'error');
                return;
            }
            
            showModal(`
                <div class="modal-header">
                    <h2>🗑️ Excluir Benefício</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <p><strong>Funcionário:</strong> ${benefit.employeeName}</p>
                    <p><strong>Benefício:</strong> ${getBenefitTypeIcon(benefit.type)} ${getBenefitTypeName(benefit.type)}</p>
                    <p><strong>Valor:</strong> R$ ${benefit.value.toLocaleString('pt-BR')}</p>
                </div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px 0; color: #856404;">
                    <strong>⚠️ Atenção:</strong> O benefício será removido permanentemente do sistema.
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button class="btn btn-danger" onclick="executeBenefitDeletion(${id})">🗑️ Confirmar Exclusão</button>
                </div>
            `);
        }

        function executeBenefitDeletion(id) {
            const benefit = benefits.find(b => b.id === id);
            if (!benefit) {
                showToast('Benefício não encontrado!', 'error');
                return;
            }
            
            try {
                const benefitIndex = benefits.findIndex(b => b.id === id);
                if (benefitIndex === -1) {
                    showToast('Benefício não encontrado!', 'error');
                    return;
                }
                
                const deletedBenefit = benefits[benefitIndex];
                benefits.splice(benefitIndex, 1);
                
                closeModal();
                showToast(`✅ Benefício de ${deletedBenefit.employeeName} excluído com sucesso!`);
                
                // Refresh current view
                if (currentTab === 'benefits') {
                    renderBenefits();
                } else if (currentTab === 'dashboard') {
                    renderDashboard();
                } else {
                    showTab('dashboard');
                }
                
            } catch (error) {
                console.error('Erro ao excluir benefício:', error);
                showToast('Erro ao excluir benefício!', 'error');
            }
        }

        // Vales Functions
        function addVale() {
            const activeEmployees = employees.filter(e => e.status === 'active');
            
            showModal(`
                <div class="modal-header">
                    <h2>💳 Adicionar Vale</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <form onsubmit="createVale(event)">
                    <div class="form-group">
                        <label class="form-label">Funcionário</label>
                        <select class="form-control" name="employeeId" required>
                            <option value="">Selecione o funcionário</option>
                            ${activeEmployees.map(emp => 
                                `<option value="${emp.id}">${emp.name} (${emp.matricula})</option>`
                            ).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Tipo de Vale</label>
                        <select class="form-control" name="type" required>
                            <option value="">Selecione o tipo</option>
                            <option value="alimentacao">🍽️ Vale Alimentação</option>
                            <option value="transporte">🚗 Vale Transporte</option>
                            <option value="combustivel">⛽ Vale Combustível</option>
                            <option value="refeicao">🍴 Vale Refeição</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Valor (R$)</label>
                        <input type="number" class="form-control" name="value" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data</label>
                        <input type="date" class="form-control" name="date" value="${new Date().toISOString().split('T')[0]}" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descrição</label>
                        <input type="text" class="form-control" name="description" required>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                        <button type="submit" class="btn btn-success">💾 Salvar</button>
                    </div>
                </form>
            `);
        }

        function createVale(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            const employeeId = parseInt(formData.get('employeeId'));
            const employee = employees.find(e => e.id === employeeId);
            
            if (!employee) {
                showToast('Funcionário não encontrado!', 'error');
                return;
            }
            
            const newVale = {
                id: Date.now(),
                employeeId: employeeId,
                employeeName: employee.name,
                value: parseFloat(formData.get('value')),
                date: formData.get('date'),
                type: formData.get('type'),
                description: formData.get('description'),
                status: 'ativo'
            };
            
            vales.push(newVale);
            closeModal();
            showToast(`Vale adicionado para ${employee.name}!`);
            
            // Refresh current view
            if (currentTab === 'vales') {
                renderVales();
            } else {
                showTab('dashboard');
            }
        }

        function viewVale(id) {
            const vale = vales.find(v => v.id === id);
            if (!vale) return;
            
            showModal(`
                <div class="modal-header">
                    <h2>💳 Detalhes do Vale</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <div style="display: grid; gap: 15px;">
                    <p><strong>Funcionário:</strong> ${vale.employeeName}</p>
                    <p><strong>Tipo:</strong> ${getValeTypeIcon(vale.type)} ${getValeTypeName(vale.type)}</p>
                    <p><strong>Valor:</strong> R$ ${vale.value.toLocaleString('pt-BR')}</p>
                    <p><strong>Data:</strong> ${formatDate(vale.date)}</p>
                    <p><strong>Descrição:</strong> ${vale.description}</p>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="closeModal()">Fechar</button>
                </div>
            `);
        }

        function confirmDeleteVale(id) {
            const vale = vales.find(v => v.id === id);
            if (!vale) {
                showToast('Vale não encontrado!', 'error');
                return;
            }
            
            showModal(`
                <div class="modal-header">
                    <h2>🗑️ Excluir Vale</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <p><strong>Funcionário:</strong> ${vale.employeeName}</p>
                    <p><strong>Vale:</strong> ${getValeTypeIcon(vale.type)} ${getValeTypeName(vale.type)}</p>
                    <p><strong>Valor:</strong> R$ ${vale.value.toLocaleString('pt-BR')}</p>
                    <p><strong>Data:</strong> ${formatDate(vale.date)}</p>
                </div>
                
                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 20px 0; color: #856404;">
                    <strong>⚠️ Atenção:</strong> O vale será removido permanentemente do sistema.
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                    <button class="btn btn-danger" onclick="executeValeDeletion(${id})">🗑️ Confirmar Exclusão</button>
                </div>
            `);
        }

        function executeValeDeletion(id) {
            const vale = vales.find(v => v.id === id);
            if (!vale) {
                showToast('Vale não encontrado!', 'error');
                return;
            }
            
            try {
                const valeIndex = vales.findIndex(v => v.id === id);
                if (valeIndex === -1) {
                    showToast('Vale não encontrado!', 'error');
                    return;
                }
                
                const deletedVale = vales[valeIndex];
                vales.splice(valeIndex, 1);
                
                closeModal();
                showToast(`✅ Vale de ${deletedVale.employeeName} excluído com sucesso!`);
                
                // Refresh current view
                if (currentTab === 'vales') {
                    renderVales();
                } else if (currentTab === 'dashboard') {
                    renderDashboard();
                } else {
                    showTab('dashboard');
                }
                
            } catch (error) {
                console.error('Erro ao excluir vale:', error);
                showToast('Erro ao excluir vale!', 'error');
            }
        }

        // Settings Functions
        function addUser() {
            showModal(`
                <div class="modal-header">
                    <h2>👤 Adicionar Usuário</h2>
                    <button class="close-btn" onclick="closeModal()">×</button>
                </div>
                
                <form onsubmit="createUser(event)">
                    <div class="form-group">
                        <label class="form-label">Nome Completo</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Senha</label>
                        <input type="password" class="form-control" name="password" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Função</label>
                        <select class="form-control" name="role" required>
                            <option value="">Selecione a função</option>
                            <option value="admin">🔑 Administrador</option>
                            <option value="user">👨‍💼 Usuário</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                        <button type="submit" class="btn btn-success">💾 Criar</button>
                    </div>
                </form>
            `);
        }

        function createUser(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            
            if (systemUsers.some(u => u.email === formData.get('email'))) {
                showToast('Este email já está cadastrado!', 'error');
                return;
            }
            
            const newUser = {
                id: Date.now(),
                name: formData.get('name'),
                email: formData.get('email'),
                password: formData.get('password'),
                role: formData.get('role'),
                status: 'active'
            };
            
            systemUsers.push(newUser);
            closeModal();
            showToast(`Usuário ${newUser.name} criado com sucesso!`);
            renderSettings();
        }

        function confirmDeleteUser(id) {
            const user = systemUsers.find(u => u.id === id);
            if (!user) return;
            
            showConfirmation(
                `Tem certeza que deseja excluir o usuário "${user.name}"?`,
                () => deleteUser(id)
            );
        }

        function deleteUser(id) {
            const userIndex = systemUsers.findIndex(u => u.id === id);
            if (userIndex > -1) {
                const user = systemUsers[userIndex];
                systemUsers.splice(userIndex, 1);
                showToast(`Usuário ${user.name} excluído com sucesso!`);
                renderSettings();
            }
        }

        // Special Actions
        function markVacationTaken(id) {
            showConfirmation(
                'Confirma que as férias foram concluídas?',
                () => {
                    const empIndex = employees.findIndex(e => e.id === id);
                    if (empIndex > -1) {
                        employees[empIndex].lastVacation = new Date().toISOString().split('T')[0];
                        showToast(`Férias marcadas como concluídas!`);
                        renderVacation();
                    }
                }
            );
        }

        function renewContract(id) {
            showConfirmation(
                'Confirma a efetivação deste funcionário como CLT?',
                () => {
                    const empIndex = employees.findIndex(e => e.id === id);
                    if (empIndex > -1) {
                        employees[empIndex].contractType = 'permanent';
                        employees[empIndex].contract = 'CLT';
                        showToast(`Funcionário efetivado com sucesso!`);
                        renderExperience();
                    }
                }
            );
        }

        function extendContract(id) {
            showConfirmation(
                'Confirma a prorrogação do contrato de experiência por mais 30 dias?',
                () => {
                    const empIndex = employees.findIndex(e => e.id === id);
                    if (empIndex > -1) {
                        const currentAdmission = new Date(employees[empIndex].admission);
                        currentAdmission.setDate(currentAdmission.getDate() + 30);
                        employees[empIndex].admission = currentAdmission.toISOString().split('T')[0];
                        showToast(`Contrato prorrogado por mais 30 dias!`);
                        renderExperience();
                    }
                }
            );
        }

        // Import/Export Functions
        function handleCsvImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.endsWith('.csv')) {
                showToast('Por favor, selecione um arquivo CSV!', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    let csv = e.target.result;
                    
                    // Auto-detect and fix separator
                    const firstLine = csv.split('\n')[0];
                    const semicolonCount = (firstLine.match(/;/g) || []).length;
                    const commaCount = (firstLine.match(/,/g) || []).length;
                    
                    let separator = ',';
                    if (semicolonCount > commaCount && semicolonCount >= 10) {
                        separator = ';';
                        console.log('Detectado separador ";" - convertendo para ","');
                        csv = csv.replace(/;/g, ',');
                    }
                    
                    // Remove carriage returns
                    csv = csv.replace(/\r/g, '');
                    
                    const lines = csv.trim().split('\n');
                    
                    // Skip empty lines
                    const validLines = lines.filter(line => line.trim().length > 0);
                    
                    if (validLines.length <= 1) {
                        showToast('Arquivo CSV vazio ou sem dados!', 'error');
                        event.target.value = '';
                        return;
                    }
                    
                    const data = validLines.slice(1); // Skip header
                    
                    let imported = 0;
                    let errors = 0;
                    let errorDetails = [];
                    let fixes = [];
                    
                    data.forEach((line, index) => {
                        try {
                            // Parse CSV line more carefully, handling quoted fields
                            const fields = parseCSVLine(line);
                            
                            if (fields.length < 11) {
                                errors++;
                                errorDetails.push(`Linha ${index + 2}: Campos insuficientes (${fields.length}/11)`);
                                return;
                            }
                            
                            // Validate required fields
                            if (!fields[0] || !fields[1] || !fields[2]) {
                                errors++;
                                errorDetails.push(`Linha ${index + 2}: Matrícula, nome ou cargo não informados`);
                                return;
                            }
                            
                            let fixedDate = formatDateForInput(fields[9].trim());
                            if (!fixedDate && fields[9].trim()) {
                                // Try to fix DD/MM/YYYY format
                                const brazilianDate = fields[9].trim();
                                if (brazilianDate.includes('/')) {
                                    const parts = brazilianDate.split('/');
                                    if (parts.length === 3 && parts[2].length === 4) {
                                        fixedDate = `${parts[2]}-${parts[1].padStart(2, '0')}-${parts[0].padStart(2, '0')}`;
                                        fixes.push(`Data ${brazilianDate} → ${fixedDate}`);
                                    }
                                }
                            }
                            
                            let contractType = normalizeContractType(fields[10].trim());
                            if (fields[10].trim() === 'CENTERTEL') {
                                contractType = 'permanent';
                                fixes.push(`Tipo contrato CENTERTEL → CLT`);
                            }
                            
                            const newEmployee = {
                                id: Date.now() + Math.random() * 1000 + imported,
                                matricula: fields[0].trim().toUpperCase(),
                                name: fields[1].trim().toUpperCase(),
                                position: fields[2].trim().toUpperCase(),
                                team: fields[3].trim().toUpperCase() || 'INDEFINIDO',
                                salary: parseFloat(fields[4].replace(/[^\d.,]/g, '').replace(',', '.')) || 0,
                                contract: fields[5].trim().toUpperCase() || 'CLT',
                                email: fields[6].trim().toLowerCase(),
                                phone: fields[7].trim(),
                                city: fields[8].trim().toUpperCase() || 'GOIÂNIA',
                                admission: fixedDate || new Date().toISOString().split('T')[0],
                                contractType: contractType,
                                status: 'active',
                                lastVacation: null
                            };
                            
                            // Check for duplicate matricula
                            if (employees.some(e => e.matricula === newEmployee.matricula)) {
                                errors++;
                                errorDetails.push(`Linha ${index + 2}: Matrícula ${newEmployee.matricula} já existe`);
                                return;
                            }
                            
                            // Validate email format
                            if (newEmployee.email && !isValidEmail(newEmployee.email)) {
                                const oldEmail = newEmployee.email;
                                newEmployee.email = `${newEmployee.matricula.toLowerCase()}@centertel.com`;
                                fixes.push(`Email ${oldEmail} → ${newEmployee.email}`);
                            }
                            
                            employees.push(newEmployee);
                            imported++;
                            
                        } catch (lineError) {
                            errors++;
                            errorDetails.push(`Linha ${index + 2}: Erro ao processar - ${lineError.message}`);
                        }
                    });
                    
                    // Show detailed results
                    if (imported > 0) {
                        showToast(`✅ Importação concluída! ${imported} funcionários importados${errors > 0 ? `, ${errors} erros` : ''}.`);
                        
                        // Refresh current view
                        if (currentTab === 'employees') {
                            renderEmployees();
                        } else if (currentTab === 'dashboard') {
                            renderDashboard();
                        }
                    } else {
                        showToast('Nenhum funcionário foi importado!', 'error');
                    }
                    
                    // Show detailed results
                    if (errors > 0 || fixes.length > 0) {
                        showModal(`
                            <div class="modal-header">
                                <h2>📊 Relatório de Importação</h2>
                                <button class="close-btn" onclick="closeModal()">×</button>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <p><strong>✅ Importados:</strong> ${imported} funcionários</p>
                                <p><strong>❌ Erros:</strong> ${errors}</p>
                                <p><strong>🔧 Correções automáticas:</strong> ${fixes.length}</p>
                            </div>
                            
                            ${fixes.length > 0 ? `
                                <div style="background: #d4edda; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                    <h4>🔧 Correções aplicadas automaticamente:</h4>
                                    <ul style="margin: 10px 0; padding-left: 20px; max-height: 150px; overflow-y: auto;">
                                        ${fixes.slice(0, 15).map(fix => `<li style="margin: 3px 0;">${fix}</li>`).join('')}
                                        ${fixes.length > 15 ? `<li><em>... e mais ${fixes.length - 15} correções</em></li>` : ''}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            ${errorDetails.length > 0 ? `
                                <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                                    <h4>⚠️ Erros encontrados:</h4>
                                    <ul style="margin: 10px 0; padding-left: 20px; max-height: 150px; overflow-y: auto;">
                                        ${errorDetails.slice(0, 10).map(error => `<li style="margin: 3px 0;">${error}</li>`).join('')}
                                        ${errorDetails.length > 10 ? `<li><em>... e mais ${errorDetails.length - 10} erros</em></li>` : ''}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0; font-size: 0.9em;">
                                <strong>✅ Formatos aceitos:</strong><br>
                                • <strong>Separadores:</strong> vírgula (,) ou ponto e vírgula (;)<br>
                                • <strong>Datas:</strong> DD/MM/YYYY ou YYYY-MM-DD<br>
                                • <strong>Tipo contrato:</strong> CLT, Experiencia, CENTERTEL<br>
                                • <strong>Campos obrigatórios:</strong> matricula, nome, cargo
                            </div>
                            
                            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                                <button class="btn btn-secondary" onclick="closeModal()">Fechar</button>
                            </div>
                        `);
                    }
                    
                    event.target.value = '';
                    
                } catch (error) {
                    showToast('Erro ao processar arquivo CSV: ' + error.message, 'error');
                    console.error('Erro detalhado:', error);
                    event.target.value = '';
                }
            };
            reader.readAsText(file, 'UTF-8');
        }

        // Helper function to parse CSV line properly
        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        // Helper function to normalize contract type
        function normalizeContractType(type) {
            const normalized = type.toLowerCase();
            if (normalized.includes('experiencia') || normalized.includes('experience') || normalized.includes('estagio')) {
                return 'experience';
            }
            return 'permanent';
        }

        // Helper function to format date for input
        function formatDateForInput(dateStr) {
            if (!dateStr) return null;
            
            // Try different date formats
            const formats = [
                /(\d{4})-(\d{2})-(\d{2})/, // YYYY-MM-DD
                /(\d{2})\/(\d{2})\/(\d{4})/, // DD/MM/YYYY
                /(\d{2})-(\d{2})-(\d{4})/, // DD-MM-YYYY
            ];
            
            for (let format of formats) {
                const match = dateStr.match(format);
                if (match) {
                    if (format === formats[0]) {
                        return dateStr; // Already in correct format
                    } else {
                        // Convert DD/MM/YYYY or DD-MM-YYYY to YYYY-MM-DD
                        return `${match[3]}-${match[2].padStart(2, '0')}-${match[1].padStart(2, '0')}`;
                    }
                }
            }
            
            return null;
        }

        // Helper function to validate email
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function createBackup() {
            const backup = {
                timestamp: new Date().toISOString(),
                version: "1.0",
                data: {
                    employees: employees,
                    vales: vales,
                    benefits: benefits,
                    systemUsers: systemUsers
                }
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `centertel_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('Backup criado e baixado com sucesso!');
        }

        function handleBackupRestore(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            showConfirmation(
                '⚠️ ATENÇÃO: Restaurar um backup substituirá TODOS os dados atuais. Deseja continuar?',
                () => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const backup = JSON.parse(e.target.result);
                            
                            if (backup.data) {
                                employees = backup.data.employees || [];
                                vales = backup.data.vales || [];
                                benefits = backup.data.benefits || [];
                                systemUsers = backup.data.systemUsers || [];
                                
                                showToast('Backup restaurado com sucesso!');
                                showTab('dashboard');
                            } else {
                                showToast('Arquivo de backup inválido!', 'error');
                            }
                        } catch (error) {
                            showToast('Erro ao ler arquivo de backup!', 'error');
                        }
                        event.target.value = '';
                    };
                    reader.readAsText(file);
                },
                () => {
                    event.target.value = '';
                }
            );
        }

        function downloadReport(type) {
            let csvContent = '';
            const currentDate = new Date().toISOString().split('T')[0];
            
            switch(type) {
                case 'employees':
                    csvContent = 'Matrícula,Nome,Cargo,Equipe,Salário,Email,Telefone,Admissão,Tipo Contrato\n';
                    employees.filter(e => e.status === 'active').forEach(emp => {
                        csvContent += `${emp.matricula},"${emp.name}","${emp.position}","${emp.team}",${emp.salary},"${emp.email}","${emp.phone}",${emp.admission},"${emp.contractType === 'experience' ? 'Experiência' : 'CLT'}"\n`;
                    });
                    break;
                case 'terminated':
                    csvContent = 'Matrícula,Nome,Cargo,Equipe,Salário,Email,Telefone,Admissão,Desligamento,Motivo\n';
                    employees.filter(e => e.status === 'terminated').forEach(emp => {
                        const reason = emp.terminationReason ? emp.terminationReason.replace(/_/g, ' ') : 'Não informado';
                        csvContent += `${emp.matricula},"${emp.name}","${emp.position}","${emp.team}",${emp.salary},"${emp.email}","${emp.phone}",${emp.admission},${emp.terminationDate},"${reason}"\n`;
                    });
                    break;
                case 'vales':
                    csvContent = 'Data,Funcionário,Tipo,Valor,Descrição\n';
                    vales.forEach(vale => {
                        csvContent += `${vale.date},"${vale.employeeName}","${getValeTypeName(vale.type)}",${vale.value},"${vale.description}"\n`;
                    });
                    break;
                case 'benefits':
                    csvContent = 'Funcionário,Tipo,Valor,Data Início,Data Fim,Descrição\n';
                    benefits.filter(b => b.status === 'active').forEach(benefit => {
                        csvContent += `"${benefit.employeeName}","${getBenefitTypeName(benefit.type)}",${benefit.value},${benefit.startDate},${benefit.endDate},"${benefit.description}"\n`;
                    });
                    break;
            }
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `${type}_${currentDate}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showToast('Relatório baixado com sucesso!');
        }

        function logout() {
            showConfirmation(
                'Deseja realmente sair do sistema?',
                () => {
                    location.reload();
                }
            );
        }

        // Click outside modal to close
        window.onclick = function(event) {
            const modal = document.getElementById('modal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Initialize the system
        showTab('dashboard');
    </script>
</body>
</html>